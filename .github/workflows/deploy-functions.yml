# .github/workflows/deploy-functions.yml

name: Deploy Cloud Functions to Firebase

on:
  # Este workflow se ejecuta cada vez que haces un 'push'
  # a la rama 'main' (o 'master' si usas esa)
  push:
    branches:
      - main

jobs:
  deploy_functions:
    # Usamos una máquina virtual de Ubuntu limpia para el despliegue
    runs-on: ubuntu-latest
    
    steps:
      # 1. Clona tu repositorio en la máquina virtual
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Configura Node.js a la versión 18 (estable)
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      # 3. Instala las dependencias y despliega las funciones
      - name: Install and Deploy
        run: |
          npm install -g firebase-tools
          cd functions
          npm install
          cd ..
          firebase deploy --only functions --token "${{ secrets.FIREBASE_SERVICE_ACCOUNT_ESTUD_IA_A94A3 }}"
